window.panoramicDataECharts={charts:new Map,dataSources:new Map,logging:!1,changeLogging:function(a){panoramicDataECharts.logging=a},getChart:function(a){return panoramicDataECharts.charts.get(a)},getDataSource:function(a){var t=panoramicDataECharts.dataSources.get(a);return panoramicDataECharts.logging&&(console.log(`GET CACHED FETCH ${a}`),console.log(t)),t},evaluatePath:function(a,t){const e=t.split(".");let r=a;for(const a of e){if(!r.hasOwnProperty(a))return;r=r[a]}return r},fetchExternalData:async function(chart,fetchOptions){if(null!=fetchOptions)for(item of(chart.__dataSources=[],JSON.parse(fetchOptions))){panoramicDataECharts.logging&&(console.log(`FETCH ${item.id}`),console.log(item));const response=await fetch(item.url,item.options);if(!response.ok)throw new Error("Failed to fetch external chart data: url="+url);var data=null;if("json"==item.fetchAs){if(data=await response.json(),null!=item.path)try{data=panoramicDataECharts.evaluatePath(data,item.path)}catch(a){console.log("Failed to evaluate path expression of external data source"),console.log(a)}}else"string"==item.fetchAs&&(data=await response.text());if(panoramicDataECharts.logging&&console.log(data),null!=item.afterLoad)try{const func=eval(`(${item.afterLoad})`);data=func(data)}catch(a){console.log("Failed to execute afterLoad function of external data source"),console.log(a)}window.panoramicDataECharts.dataSources.set(item.id,data),chart.__dataSources.push(item.id)}},registerMaps:function(chart,mapOptions){if(null!=mapOptions){var parsedOptions=eval("("+mapOptions+")");for(item of parsedOptions)panoramicDataECharts.logging&&(console.log("MAP"),console.log(item)),"geoJSON"===item.type?echarts.registerMap(item.mapName,{geoJSON:item.geoJSON,specialAreas:item.specialAreas}):"svg"===item.type&&echarts.registerMap(item.mapName,{svg:item.svg})}},initChart:async function(id,theme,initOptions,chartOptions,mapOptions,fetchOptions){var chart=echarts.init(document.getElementById(id),theme,JSON.parse(initOptions));if(panoramicDataECharts.charts.set(id,chart),chart.showLoading(),null!=chartOptions){await panoramicDataECharts.fetchExternalData(chart,fetchOptions),await panoramicDataECharts.registerMaps(chart,mapOptions);var parsedOptions=eval("("+chartOptions+")");panoramicDataECharts.logging&&(console.log("CHART"),console.log(parsedOptions)),chart.setOption(parsedOptions),chart.hideLoading()}},updateChart:async function(id,chartOptions,mapOptions,fetchOptions){var chart=panoramicDataECharts.charts.get(id);if(null!=chart){await panoramicDataECharts.fetchExternalData(chart,fetchOptions),await panoramicDataECharts.registerMaps(chart,mapOptions);var parsedOptions=eval("("+chartOptions+")");chart.setOption(parsedOptions),chart.hideLoading()}else console.error("Failed to retrieve chart "+id)},clearChart:function(a){var t=panoramicDataECharts.charts.get(a);null!=t?t.clear():console.error("Failed to clear chart "+a)},disposeChart:function(a){var t=panoramicDataECharts.charts.get(a);null!=t?(t.__dataSources&&Array.isArray(t.__dataSources)&&t.__dataSources.forEach(a=>{window.panoramicDataECharts.dataSources.delete(a)}),echarts.dispose(t),panoramicDataECharts.charts.delete(a)):console.error("Failed to dispose chart "+a)}};